---
# collection "Browse" page
layout: page
custom-foot: js/browse-js.html
---

{{ content }}

<style>
    #browseSection {
        display: none;
    }

    #browseSection.active {
        display: block;
    }
</style>

<div id="browseSection">
    <div class="row mb-3">
        <div class="col-12">
            <button class="btn btn-outline-dark mb-3" onclick="showGenreSelection()">
                &laquo; Back to Genres
            </button>
            <h3 class="d-inline-block ms-3">Genre: <span id="currentGenreTitle" class="fw-bold text-primary"></span>
            </h3>
        </div>
    </div>

    <div class="row mb-3 justify-content-center">
        <div class="col-md-8 text-center">
            <form role="search" id="browseFilter" onsubmit="submitFilter(); return false;">
                <div class="input-group input-group-lg">
                    <input type="text" class="form-control" id="filterTextBox" placeholder="Filter ... "
                        aria-label="Search">
                    <button class="btn btn-success" type="submit" title="Filter items" id="filterButton">Search</button>
                    <button class="btn btn-outline-secondary filter" onclick="resetFilter(); return false;"
                        data-filter="">Reset</button>
                </div>
            </form>
            <div class="h2" id="numberOf"></div>
        </div>
        <div class="col-md-2">
            <div class="dropdown">
                <button class="btn btn-secondary mt-1 dropdown-toggle" type="button" id="browseSortButton"
                    data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Sort by <span id="sortFilter">Random</span>
                </button>
                <div class="dropdown-menu browse-sort-menu" aria-labelledby="browseSortButton">
                    <button class="dropdown-item browse-sort-item active" data-filter="random">Random</button>
                    <button class="dropdown-item browse-sort-item" data-filter="title">Title</button>
                    {% assign sort_options = site.data.config-browse | where_exp: 'i','i.sort_name != nil' %}
                    {% for o in sort_options %}
                    <button class="dropdown-item browse-sort-item" data-filter="{{ o.field | escape }}">{{ o.sort_name
                        }}</button>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="browseItems"></div>
</div>

<div id="loadingIcon" class="text-center">
    <div class="spinner-border text-dark" role="status"><span class="visually-hidden">Loading...</span></div>
</div>

<!-- Genre/Subject Filters -->
{% assign raw_subjects = site.data[site.metadata] | map: 'subject' | compact %}
{% assign subjects = raw_subjects | uniq | sort %}
<style>
    .genre-card {
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .genre-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22) !important;
        z-index: 10;
    }

    .genre-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0.1) 100%);
        pointer-events: none;
    }
</style>

<div class="container mb-5" id="genreSection">
    <! -- Added ID here -->
        <div class="row justify-content-center g-3" id="genre-filters">
            <div class="col-12 text-center mb-3">
                <h5 class="text-muted text-uppercase fw-bold ls-1" style="letter-spacing: 2px;">Explore Genres</h5>
            </div>
            {% for subject in subjects %}
            {% capture color %}{% cycle '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEEAD', '#D4A5A5', '#9B59B6',
            '#3498DB', '#E67E22', '#2ECC71' %}{% endcapture %}
            <div class="col-auto">
                <div onclick="filterByGenre('{{ subject | url_encode }}')"
                    class="genre-card card text-decoration-none border-0 shadow-sm py-3 px-4 d-flex align-items-center justify-content-center"
                    style="background-color: {{ color }}; min-width: 140px; border-radius: 50px;">
                    <span class="h6 m-0 fw-bold text-white text-shadow"
                        style="text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">{{
                        subject }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
</div>

<script>
    let currentGenre = null;

    function filterByGenre(encodedGenre) {
        // Decode the genre coming from Liquid
        let genre = decodeURIComponent(encodedGenre.replace(/\+/g, ' '));

        currentGenre = genre;
        document.getElementById('genreSection').style.display = 'none';

        // Use classList for active state as requested
        document.getElementById('browseSection').classList.add('active');

        document.getElementById('currentGenreTitle').textContent = genre;

        // Set the filter to the genre
        document.getElementById('filterTextBox').value = genre;
        submitFilter();
    }

    function showGenreSelection() {
        document.getElementById('genreSection').style.display = 'block';
        document.getElementById('browseSection').classList.remove('active');
        currentGenre = null;
        document.getElementById('filterTextBox').value = '';
        // Clear the current filter to show "nothing" or reset? 
        // Usually, when going back to genres, we might want to clear the search items or just reset.
        // The resetFilter() function in browse-js clears it.
        resetFilter();
    }
</script>